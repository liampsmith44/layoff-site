<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Layoff Betting</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background-color: transparent; }
    .container { max-width: 800px; background-color: #f7f7f7; padding: 20px; box-shadow: 0 0 10px rgba(0,0,0,.1); margin: 0 auto; }
    h2 { margin-top: 0; padding-bottom: 10px; color: #fff; background-color: #171717; padding: 10px; font-size: 14px; text-transform: uppercase; text-align: left; }
    .section { margin-bottom: 30px; padding: 15px; font-size: 12px; background-color: #e6e8eb; border-radius: 8px; }
    .bet-section { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px; }
    .bet-section-header { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px; margin-bottom: 5px; padding-top: 10px; text-align: left; }
    .bet-section input { padding: 10px; width: 100%; box-sizing: border-box; }
    button { padding: 10px; background-color: #D4AF37; color: #000; border: none; cursor: pointer; width: 100%; margin-top: 10px; }
    button:hover { background-color: #a58922; }
    .calculate-button { background-color: #F77818; color: #fff; }
    .calculate-button:hover { background-color: #d9721b; }
    .clear-button { background-color: #888; color: #fff; }
    .clear-button:hover { background-color: #6f6f6f; }
    .output { margin-top: 20px; padding: 10px; background-color: #e7f3e7; border-left: 5px solid #4CAF50; }
    .profit { color: green; }
    .loss { color: red; }
    .total-live-summary { padding: 10px 0; display: flex; justify-content: space-between; align-items: center; font-weight: bold; color: #fff; background-color: #4A4A4A; padding: 10px; }
    .collect-column { font-weight: bold; }
    .section h2 { margin-bottom: 20px; }
    label { margin-bottom: 10px; display: block; }
    @media (max-width: 768px) {
      .bet-section, .bet-section-header { grid-template-columns: 1fr 1fr 1fr 1fr; }
      button { width: 100%; }
    }
    @media (max-width: 480px) {
      body { margin: 10px; }
      .container { padding: 15px; }
      .bet-section input { padding: 8px; }
      button { padding: 8px; }
      .calculate-button { padding: 12px; }
    }
    .error { color: red; font-size: 12px; margin-top: 5px; }
  </style>
</head>
<body>
  <div class="container">
    <!-- Live Bet Section -->
    <div class="section">
      <h2>Live Bets</h2>

      <div class="total-live-summary" id="running-total">
        <div>TOTAL LIVE BETS:</div>
        <div>TOTAL STAKE: $0.00</div>
        <div>MAX PROFIT: $0.00</div>
      </div>

      <div class="bet-section-header">
        <div><strong>Reference Name</strong></div>
        <div><strong>Bet Stake ($)</strong></div>
        <div><strong>Bet Odds ($)</strong></div>
        <div class="collect-column"><strong>Collect</strong></div>
      </div>

      <div id="live-bets-container">
        <div class="bet-section">
          <div>
            <input type="text" id="bet1Name-1" placeholder="Enter bet reference name"
                   oninput="updateRunningTotal()" />
          </div>
          <div>
            <input type="text" id="bet1Amount-1" placeholder="Enter your live bet amount"
                   oninput="validateInput(this,'number'); updateRunningTotal(); updateCollect(1);" />
            <div id="error-bet1Amount-1" class="error"></div>
          </div>
          <div>
            <input type="text" id="odds1-1" step="0.01" placeholder="Enter the odds"
                   oninput="validateInput(this,'decimal'); updateRunningTotal(); updateCollect(1);" />
            <div id="error-odds1-1" class="error"></div>
          </div>
          <div>
            <span id="collect1-1">$0.00</span>
          </div>
        </div>
      </div>

      <button onclick="addLiveBet()">Add Another Live Bet</button>
    </div>

    <!-- Layoff Bet Section -->
    <div class="section">
      <h2>Layoff Bets</h2>

      <div class="bet-section-header">
        <div><strong>Reference Name</strong></div>
        <div><strong>Layoff Bet Odds ($)</strong></div>
        <div><strong>Set amount to profit ($)</strong></div>
        <div></div>
      </div>

      <div id="layoff-bets-container">
        <div class="bet-section">
          <div>
            <input type="text" id="bet2Name-1" placeholder="Enter bet reference name" />
          </div>
          <div>
            <input type="text" id="odds2-1" step="0.01" placeholder="Enter the odds"
                   oninput="validateInput(this,'decimal')" />
            <div id="error-odds2-1" class="error"></div>
          </div>
          <div>
            <input type="text" id="setAmount-1" placeholder="Enter profit amount"
                   oninput="validateInput(this,'number')" />
            <div id="error-setAmount-1" class="error"></div>
          </div>
          <div></div>
        </div>
      </div>

      <button onclick="addLayoffBet()">Add Another Layoff Bet</button>
    </div>

    <button class="clear-button" onclick="clearAllFields()">Clear All</button>
    <button class="calculate-button" onclick="calculateLayoff()">Calculate Layoff Bet</button>
    <p style="font-size: 12px; text-align: center;">www.layoff.com.au</p>

    <!-- Output Section -->
    <div class="output" id="output"></div>
  </div>

  <script>
    let liveBetCount = 1;
    let layoffBetCount = 1;

    // Basic input validation
    function validateInput(input, type) {
      const value = input.value.trim();
      const regex = (type === 'number')
        ? /^[0-9]+(?:\.[0-9]+)?$/           // allow integers or decimals
        : /^[0-9]+(?:\.[0-9]+)?$/;         // decimals for odds

      const errId = `error-${input.id}`;
      const errorDiv = document.getElementById(errId);
      if (!errorDiv) return;

      if (value !== '' && !regex.test(value)) {
        errorDiv.textContent = 'Numbers only';
      } else {
        errorDiv.textContent = '';
      }
    }

    // Update "collect" cell for a live bet row
    function updateCollect(row) {
      const stake = parseFloat(document.getElementById(`bet1Amount-${row}`)?.value) || 0;
      const odds  = parseFloat(document.getElementById(`odds1-${row}`)?.value) || 0;
      const collect = isFinite(stake * odds) ? stake * odds : 0;
      const cell = document.getElementById(`collect1-${row}`);
      if (cell) cell.textContent = `$${collect.toFixed(2)}`;
    }

    // Running totals bar
    function updateRunningTotal() {
      let totalLiveStake = 0;
      let maxCollect = 0;

      for (let i = 1; i <= liveBetCount; i++) {
        const stake = parseFloat(document.getElementById(`bet1Amount-${i}`)?.value) || 0;
        const odds  = parseFloat(document.getElementById(`odds1-${i}`)?.value) || 0;
        const collectDisplay = document.getElementById(`collect1-${i}`);

        if (stake > 0 && odds > 0) {
          totalLiveStake += stake;
          const collectAmount = stake * odds;
          if (collectAmount > maxCollect) maxCollect = collectAmount;
          if (collectDisplay) collectDisplay.textContent = `$${collectAmount.toFixed(2)}`;
        } else if (collectDisplay) {
          collectDisplay.textContent = `$0.00`;
        }
      }

      const maxProfit = Math.max(0, maxCollect - totalLiveStake);
      const run = document.getElementById('running-total');
      run.innerHTML = `
        <div>TOTAL LIVE BETS:</div>
        <div>TOTAL STAKE: $${totalLiveStake.toFixed(2)}</div>
        <div>MAX PROFIT: $${maxProfit.toFixed(2)}</div>
      `;
    }

    // Add another live bet row
    function addLiveBet() {
      liveBetCount++;
      const container = document.getElementById('live-bets-container');
      const betSection = document.createElement('div');
      betSection.classList.add('bet-section');

      betSection.innerHTML = `
        <div>
          <input type="text" id="bet1Name-${liveBetCount}" placeholder="Enter reference name"
                 oninput="updateRunningTotal()" />
        </div>
        <div>
          <input type="text" id="bet1Amount-${liveBetCount}" placeholder="Enter your live bet amount"
                 oninput="validateInput(this,'number'); updateRunningTotal(); updateCollect(${liveBetCount});" />
          <div id="error-bet1Amount-${liveBetCount}" class="error"></div>
        </div>
        <div>
          <input type="text" id="odds1-${liveBetCount}" step="0.01" placeholder="Enter the odds"
                 oninput="validateInput(this,'decimal'); updateRunningTotal(); updateCollect(${liveBetCount});" />
          <div id="error-odds1-${liveBetCount}" class="error"></div>
        </div>
        <div>
          <span id="collect1-${liveBetCount}">$0.00</span>
        </div>
      `;
      container.appendChild(betSection);
    }

    // Add another layoff bet row
    function addLayoffBet() {
      layoffBetCount++;
      const container = document.getElementById('layoff-bets-container');
      const betSection = document.createElement('div');
      betSection.classList.add('bet-section');

      betSection.innerHTML = `
        <div>
          <input type="text" id="bet2Name-${layoffBetCount}" placeholder="Enter reference name" />
        </div>
        <div>
          <input type="text" id="odds2-${layoffBetCount}" step="0.01" placeholder="Enter the odds"
                 oninput="validateInput(this,'decimal')" />
          <div id="error-odds2-${layoffBetCount}" class="error"></div>
        </div>
        <div>
          <input type="text" id="setAmount-${layoffBetCount}" placeholder="Enter profit amount"
                 oninput="validateInput(this,'number')" />
          <div id="error-setAmount-${layoffBetCount}" class="error"></div>
        </div>
        <div></div>
      `;
      container.appendChild(betSection);
    }


// pretty money
function money(x){ return '$' + Number(x).toFixed(2); }

// simple Gaussian elimination (no external libs)
function solveLinearSystem(A, b) {
  const n = A.length;
  // Deep copy
  A = A.map(row => row.slice());
  b = b.slice();

  const EPS = 1e-9;

  // Forward elimination
  for (let i = 0; i < n; i++) {
    // pivot
    let piv = i;
    for (let r = i + 1; r < n; r++) {
      if (Math.abs(A[r][i]) > Math.abs(A[piv][i])) piv = r;
    }
    if (Math.abs(A[piv][i]) < EPS) throw new Error('System is singular or ill-conditioned.');
    // swap rows
    if (piv !== i) {
      [A[i], A[piv]] = [A[piv], A[i]];
      [b[i], b[piv]] = [b[piv], b[i]];
    }
    // eliminate below
    for (let r = i + 1; r < n; r++) {
      const f = A[r][i] / A[i][i];
      for (let c = i; c < n; c++) A[r][c] -= f * A[i][c];
      b[r] -= f * b[i];
    }
  }

  // Back substitution
  const x = new Array(n).fill(0);
  for (let i = n - 1; i >= 0; i--) {
    let s = b[i];
    for (let c = i + 1; c < n; c++) s -= A[i][c] * x[c];
    x[i] = s / A[i][i];
  }
  return x;
}

function calculateLayoff() {
  const out = document.getElementById('output');
  out.innerHTML = '';

  // 1) Collect live bets
  let live = [];
  let totalLiveStake = 0;

  for (let i = 1; i <= liveBetCount; i++) {
    const name  = (document.getElementById(`bet1Name-${i}`)?.value || `Live Bet ${i}`).trim();
    const stake = parseFloat(document.getElementById(`bet1Amount-${i}`)?.value);
    const odds  = parseFloat(document.getElementById(`odds1-${i}`)?.value);
    if (!isNaN(stake) && !isNaN(odds)) {
      live.push({name, stake, odds});
      totalLiveStake += stake;
    }
  }

  // 2) Collect layoff odds + targets
  let lay = [];
  for (let j = 1; j <= layoffBetCount; j++) {
    const name   = (document.getElementById(`bet2Name-${j}`)?.value || `Layoff Bet ${j}`).trim();
    const odds   = parseFloat(document.getElementById(`odds2-${j}`)?.value);
    const target = parseFloat(document.getElementById(`setAmount-${j}`)?.value);
    if (!isNaN(odds) && odds > 1 && !isNaN(target)) {
      lay.push({name, odds, target});
    }
  }

  if (lay.length === 0) {
    out.innerHTML = '<em>Please enter at least one layoff bet (odds + target profit).</em>';
    return;
  }

  // 3) Build Ax=b
  const n = lay.length;
  const A = Array.from({length:n}, () => Array(n).fill(0));
  const b = Array(n).fill(0);

  for (let r = 0; r < n; r++) {
    for (let c = 0; c < n; c++) {
      A[r][c] = (r === c) ? (lay[r].odds - 1) : -1;
    }
    b[r] = totalLiveStake + lay[r].target;
  }

  // 4) Solve for stakes
  let stakes;
  try {
    stakes = solveLinearSystem(A, b);
  } catch (e) {
    out.innerHTML = `<span class="loss">Could not compute stakes: ${e.message}</span>`;
    return;
  }

  // Optional: clamp tiny negative (-0.00) to zero due to floating point
  stakes = stakes.map(x => Math.abs(x) < 1e-7 ? 0 : x);

  // Show layoff stakes
  let totalLayoffStake = 0;
  for (let i = 0; i < n; i++) {
    const s = stakes[i];
    totalLayoffStake += s;
    out.innerHTML += `Back <strong>${lay[i].name}</strong>: Stake <strong>${money(s)}</strong> at odds of <strong>${lay[i].odds.toFixed(2)}</strong><br/>`;
  }
  out.innerHTML += '<br/>';

  // 5) Actual profits for each outcome
  const totalOutlay = totalLiveStake + totalLayoffStake;

  // Live outcomes
  for (const bLive of live) {
    const profit = bLive.stake * bLive.odds - totalOutlay;
    const cls = profit >= 0 ? 'profit' : 'loss';
    out.innerHTML += `<span class="${cls}">If ${bLive.name} wins: ${profit >= 0 ? '+' : ''}${money(profit)}</span><br/>`;
  }

  // Layoff outcomes (these should match targets, modulo rounding cents)
  for (let i = 0; i < n; i++) {
    const profit = stakes[i] * lay[i].odds - totalOutlay;
    const cls = profit >= 0 ? 'profit' : 'loss';
    out.innerHTML += `<span class="${cls}">If ${lay[i].name} wins: ${profit >= 0 ? '+' : ''}${money(profit)}</span> (target ${money(lay[i].target)})<br/>`;
  }
}

  </script>
</body>
</html>
